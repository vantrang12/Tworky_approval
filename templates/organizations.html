{% extends "base.html" %}

{% block title %}Qu·∫£n l√Ω ph√≤ng/ban - Tworky Approval{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Qu·∫£n l√Ω ph√≤ng/ban</h1>
        <button class="btn btn-primary" onclick="openAddModal()">
            <span>‚ûï</span> Th√™m ph√≤ng/ban
        </button>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>T√™n ph√≤ng/ban</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody>
                {% for org in organizations %}
                <tr>
                    <td>{{ org.id }}</td>
                    <td>{{ org.name }}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-warning" onclick="openEditModal({{ org.id }}, '{{ org.name }}')" title="S·ª≠a">‚úèÔ∏è S·ª≠a</button>
                        <form method="POST" action="{{ url_for('delete_organization', org_id=org.id) }}" style="display: inline;" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ph√≤ng/ban {{ org.name }}?');">
                            <button type="submit" class="btn btn-sm btn-danger" title="X√≥a">üóëÔ∏è X√≥a</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal Th√™m -->
<div id="addModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Th√™m ph√≤ng/ban m·ªõi</h2>
            <span class="close" onclick="closeModal('addModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('add_organization') }}">
            <div class="form-group">
                <label for="name">T√™n ph√≤ng/ban <span class="required">*</span></label>
                <input type="text" id="name" name="name" required autofocus>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">‚ûï Th√™m</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('addModal')">H·ªßy</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal S·ª≠a -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>S·ª≠a th√¥ng tin ph√≤ng/ban</h2>
            <span class="close" onclick="closeModal('editModal')">&times;</span>
        </div>
        <form method="POST" id="editForm">
            <div class="form-group">
                <label for="edit_name">T√™n ph√≤ng/ban <span class="required">*</span></label>
                <input type="text" id="edit_name" name="name" required>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">üíæ C·∫≠p nh·∫≠t</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('editModal')">H·ªßy</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function openAddModal() {
        document.getElementById('addModal').style.display = 'flex';
        document.getElementById('name').focus();
    }
    
    function openEditModal(id, name) {
        document.getElementById('editForm').action = '/organizations/' + id + '/edit';
        document.getElementById('edit_name').value = name;
        document.getElementById('editModal').style.display = 'flex';
        document.getElementById('edit_name').focus();
    }
    
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }
    
    // ƒê√≥ng modal khi click b√™n ngo√†i
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = 'none';
        }
    }
    
    // ƒê√≥ng modal khi nh·∫•n ESC
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }
    });
</script>
{% endblock %}